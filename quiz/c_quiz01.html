<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í€´ì¦ˆê³¼ì œ</title>
    <link rel="stylesheet" href="./assets/css/c_quiz.css">
</head>

<body>
    <main id="main">
        <div class="quiz__wrap">

        </div>
    </main>
    <!-- //main -->

    <script>
        // ì„ íƒì 
        const quizWrap = document.querySelector(".quiz__wrap");

        // ë³€ìˆ˜
        let currentIndex = 0;   // í˜„ì¬ ë¬¸ì œì— ëŒ€í•œ ê°’
        let goodNum = 0;
        let badNum = 0;

        // ë¬¸ì œ ì •ë³´
        let quizInfo = [];   // quizInfo ë°°ì—´ì€ í€´ì¦ˆ ì •ë³´ë¥¼ ì €ì¥, ì²˜ìŒì—ëŠ” ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”ë˜ê³ , í€´ì¦ˆ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ì´ ë°°ì—´ì— ì €ì¥í•¨
        const fetchQuiz = () => {   // fetchQuiz í•¨ìˆ˜ëŠ” ì™¸ë¶€ JSON íŒŒì¼ì—ì„œ í€´ì¦ˆ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ì²˜ë¦¬
            fetch("https://webstoryboy.github.io/webstoryboy/w_json/gineungsaShort.json")
                .then(res => res.json())
                .then(items => {
                    // console.log(items);
                    quizInfo = items.map(item => {

                        // ë¬¸ì œ ì •ë³´ ì¬í• ë‹¹
                        const formattedQuiz = {
                            date: item.time,
                            question: item.question,
                            desc: item.question_desc,
                            answer: item.correct_answer,
                        }

                        // ê²°ê³¼ê°’ ì¶œë ¥
                        return formattedQuiz;
                    });

                    // ë¬¸ì œ ì¶œë ¥
                    quizInfo.splice(99, 69);
                    // quizInfo.splice(5, 178);
                    console.log(quizInfo);
                    updateQuiz(currentIndex);
                })
        }

        // ë¬¸ì œ ì¶œë ¥ 
        const updateQuiz = (index) => {
            let quizWrapTag = `<div class="quiz">
                <div class="quiz__header">
                    <span>${quizInfo.length}ë¬¸ì œ ì¤‘ ${index + 1}ë¬¸ì œì…ë‹ˆë‹¤.</span>
                    ${quizInfo[index].date}</div>                                 
               
                <div class="quiz__main">
                    <div class="question"><span>${quizInfo[index].question}</span></div> 
                    <div class="desc">${quizInfo[index].desc}</div>                      
                    <div class="input">
                        <input id="input" type="text" placeholder="ì •ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”!">                                           
                    </div>
                    <div class="answer none">${quizInfo[index].answer}</div>
                    <div class="desc none"></div>
                </div>
                <div class="quiz__footer">
                    <button class="confirm">ì •ë‹µ í™•ì¸í•˜ê¸°</button>  
                    <button class="next none">ë‹¤ìŒ ë¬¸ì œ</button>                 
                </div>
            </div>
            `;

            quizWrap.innerHTML = quizWrapTag;
            if (quizInfo[index].desc == undefined) {
                quizWrap.querySelector('.desc').classList.add('none');
            }
            // ì„ íƒì 
            const quizConfirm = quizWrap.querySelector(".confirm");
            const quizNext = quizWrap.querySelector(".next");

            // ì •ë‹µ ë²„íŠ¼ì„ í´ë¦­
            quizConfirm.addEventListener("click", () => {
                const quizInput = quizWrap.querySelector("#input"); // ì‚¬ìš©ìê°€ í´ë¦­í•œ ì •ë‹µ í™•ì¸
                const userAnswer = quizInput.value;               // ì‚¬ìš©ìê°€ í´ë¦­í•œ ì •ë‹µ
                if (userAnswer == "") {
                    alert("ë³´ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”! ğŸ¥³");


                } else {
                    const quizAnswer = quizInfo[currentIndex].answer    // ì •ë‹µì§€ì˜ ì •ë‹µ
                    const quizElement = quizWrap.querySelector(".quiz");
                    const answerElement = quizWrap.querySelector(".answer");
                    // const descElement = quizWrap.querySelector(".desc");

                    if (userAnswer == quizAnswer) {
                        goodNum++;
                        quizElement.classList.add('good')
                    } else {
                        badNum++;
                        quizElement.classList.add('bad')
                        answerElement.classList.remove('none')
                    }

                    // descElement.classList.remove("none");   // ì„¤ëª… ì¶”ê°€
                    quizConfirm.classList.add("none");  // ì •ë‹µ ë²„íŠ¼ ì‚­ì œ
                    quizNext.classList.remove("none");  // ë‹¤ìŒ ë²„íŠ¼ ì¶”ê°€

                }
            });

            // ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼ì„ í´ë¦­
            quizNext.addEventListener("click", () => {
                if (currentIndex < quizInfo.length - 1) {
                    currentIndex++;             // ë¬¸ì œ ë²ˆí˜¸ ì¦ê°€
                    updateQuiz(currentIndex);   // í€´ì¦ˆ ë°˜ì˜
                } else {
                    alert((goodNum + badNum) - badNum + "ì  ì…ë‹ˆë‹¤.")
                }
            });
        }
        fetchQuiz()
        document.addEventListener("DOMContentLoaded", () => {          // í˜ì´ì§€ê°€ ë¡œë“œëœ í›„ ì‹¤í–‰     
            updateQuiz(currentIndex);
        });

    </script>

</body>

</html>